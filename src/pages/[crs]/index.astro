---
import type { LiveTimes } from '$lib/types/liveTimes.d.ts';
import TimeTable from '$lib/time-table/TimeTable.astro';
import Global from '$layouts/Global.astro';
import { ofetch } from 'ofetch';

const data = await ofetch<LiveTimes>(
	`https://api.rtt.io/api/v1/json/search/${Astro.params.crs}`,
	{ headers: { Authorization: import.meta.env.RTT_AUTH } },
).catch(() => null);

if (!data || !data.location) {
	return Astro.redirect(
		`/?error=${data.status == 404 ? 'rtt-station-not-found' : 'unhandled'}`,
	);
}
---

<Global>
	<TimeTable times={data} />
</Global>
